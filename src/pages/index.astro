---
import Card from "../components/Card.astro";
import Layout from "../layouts/Layout.astro";
import { QUESTIONS } from "../shared/constants";
---

<Layout title="Welcome to Astro.">
  <section
    class="grid grid-cols-5 h-screen justify-center items-center gap-4 text-white px-20"
  >
    <div
      class="flex flex-col items-center justify-center gap-5 bg-[#2D3E89] p-5"
    >
      <p class="text-2xl">Cine/series</p>
      {
        QUESTIONS.CINEMA.map((question) => (
          <button
            id={question.id}
            class="flex flex-col items-center justify-center w-full h-40 bg-[#4F6BE1] rounded-md text-2xl"
            data-question={JSON.stringify(question)}
          >
            {question.position}
          </button>
        ))
      }
    </div>

    <div
      class="flex flex-col items-center justify-center gap-5 bg-[#2D3E89] p-5"
    >
      <p class="text-2xl">Noticias</p>
      {
        QUESTIONS.NEWS.map((question) => (
          <button
            id={question.id}
            class="flex flex-col items-center justify-center w-full h-40 bg-[#4F6BE1] rounded-md text-2xl"
            data-question={JSON.stringify(question)}
          >
            {question.position}
          </button>
        ))
      }
    </div>

    <div
      class="flex flex-col items-center justify-center gap-5 bg-[#2D3E89] p-5"
    >
      <p class="text-2xl">Música</p>
      {
        QUESTIONS.MUSIC.map((question) => (
          <button
            id={question.id}
            class="flex flex-col items-center justify-center w-full h-40 bg-[#4F6BE1] rounded-md text-2xl"
            data-question={JSON.stringify(question)}
          >
            {question.position}
          </button>
        ))
      }
    </div>

    <div
      class="flex flex-col items-center justify-center gap-5 bg-[#2D3E89] p-5"
    >
      <p class="text-2xl">Tecnología</p>
      {
        QUESTIONS.TECHNOLOGY.map((question) => (
          <button
            id={question.id}
            class="flex flex-col items-center justify-center w-full h-40 bg-[#4F6BE1] rounded-md text-2xl"
            data-question={JSON.stringify(question)}
          >
            {question.position}
          </button>
        ))
      }
    </div>

    <div
      class="flex flex-col items-center justify-center gap-5 bg-[#2D3E89] p-5"
    >
      <p class="text-2xl">Deporte</p>
      {
        QUESTIONS.SPORTS.map((question) => (
          <button
            id={question.id}
            class="flex flex-col items-center justify-center w-full h-40 bg-[#4F6BE1] rounded-md text-2xl"
            data-question={JSON.stringify(question)}
          >
            {question.position}
          </button>
        ))
      }
    </div>

    <dialog
      id="dialog"
      data-question=""
      class="bg-[#4F6BE1] hidden flex-col justify-center items-center text-white w-[90%] h-[90%] text-center rounded-md"
    >
      <span class="text-4xl"></span>
    </dialog>
  </section>
</Layout>

<script>
  const modal = document.getElementById("dialog");
  const modalText = document.querySelector("dialog").querySelector("span");
  const buttons = document.querySelectorAll("button");

  const localstorage = localStorage.getItem("questions");

  let questionArr: Array<{
    id: number;
    disabled: boolean;
  }> = [];

  if (typeof window !== "undefined") {
    // check if the questions are stored in local storage
    if (localstorage) questionArr = JSON.parse(localstorage);

    if (questionArr.length > 0) {
      // disable the buttons
      questionArr.forEach((question) => {
        const button = document.getElementById(question.id);
        button.disabled = true;
        button.classList.add("opacity-50");
      });
    }

    // toggle the modal
    buttons.forEach((button) => {
      button.addEventListener("click", (event) => {
        // set the modal text
        const question = JSON.parse(event.target.dataset.question);
        modalText.innerText = question.question;

        // disable the button
        event.target.disabled = true;
        event.target.classList.add("opacity-50");

        // save the question in local storage
        questionArr.push({
          id: question.id,
          disabled: true,
        });
        localStorage.setItem("questions", JSON.stringify(questionArr));

        // show the modal
        modal.classList.add("flex");
        modal.classList.remove("hidden");
        modal.showModal();
      });
    });

    modal.addEventListener("click", () => {
      modal.classList.remove("flex");
      modal.classList.add("hidden");
      modal.close();
    });
  }
</script>
